[["id]/page.tsx`(lines 418-425)\n\n**Issue**: The \"Chat\" button has no onClick handler - it's just a visual button.\n\n```tsx\n// Current (non-functional)\n<Button\n  variant=\"outline\"\n  size=\"sm\"\n  className=\"flex-1 border-slate-700 bg-transparent text-slate-300 hover:bg-slate-800 hover:text-white\"\n>\n  <MessageSquare className=\"mr-2 h-4 w-4", "Chat\n</Button>\n```\n\n**Required Changes**:\n- Import`useMessagesStore`hook\n- Add`handleChat`function to start conversation with equipment owner\n- Wire up the Chat button onClick handler\n- Add loading state for chat initiation\n\n#### 2. Labour Page\n\n**File**:`src/app/labour/page.tsx`(lines 514-539)\n\n**Issue**: The`handleSendMessage`function has a TODO comment and just shows an alert instead of actually sending messages.\n\n```tsx\n// Current (placeholder implementation)\nconst handleSendMessage = async () => {\n  // ...\n  console.log('Sending message to:', selectedLabour.user_id, messageText.trim());\n  alert('Message sent! The labourer will be notified and can respond to you.');\n};\n```\n\n**Required Changes**:\n- Import`dmService`and`useMessagesStore`\n- Update `handleSendMessage`to use`dmService.getOrCreateConversation()`and`dmService.sendMessage()`\n- Redirect to messages page after sending\n- Handle errors properly with toast notifications\n\n#### 3. User Profile Page\n\n**File**: `src/app/user/[id]/page.tsx`(lines 95-111)\n\n**Status**: \u2705 Already implemented correctly\n\nThe \"Message", "button already has proper functionality using`startConversation`from`useMessagesStore`.\n\n## Implementation Plan\n\n### Phase 1: Equipment Detail Page Chat Button\n\n**File**: `src/app/equipment/[id]/page.tsx`\n\n**Changes Required**:\n\n1. **Add imports**:\n```tsx\nimport { useMessagesStore } from '@/lib/store';\nimport { Loader2 } from 'lucide-react';\n```\n\n2. **Add state**:\n```tsx\nconst [isStartingChat, setIsStartingChat] = useState(false);\n```\n\n3. **Add handler function**:\n```tsx\nconst handleChat = async () => {\n  if (!user) {\n    router.push(`/login?redirect=/equipment/${equipmentId}`);\n    return;\n  }\n\n  if (!equipment?.owner_id) {\n    toast.error('Unable to find equipment owner');\n    return;\n  }\n\n  setIsStartingChat(true);\n  try {\n    const conversationId = await startConversation(equipment.owner_id);\n    router.push(`/messages?conversation=${conversationId}`);\n  } catch (error) {\n    console.error('Failed to start chat:', error);\n    toast.error('Failed to start chat. Please try again.');\n  } finally {\n    setIsStartingChat(false);\n  }\n};\n```\n\n4. **Update Chat button**:\n```tsx\n<Button\n  variant=\"outline\"\n  size=\"sm\"\n  onClick={handleChat}\n  disabled={isStartingChat}\n  className=\"flex-1 border-slate-700 bg-transparent text-slate-300 hover:bg-slate-800 hover:text-white\"\n>\n  {isStartingChat ? (\n    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n  ) : (\n    <MessageSquare className=\"mr-2 h-4 w-4"], {"Starting...": "Chat"}, {"@/lib/services": "import { useMessagesStore"}, {"message": ", err);\n    toast.error('Failed to send message. Please try again.", "button**": "tsx\n<Button\n  onClick={handleSendMessage"}, {"className=": "lex-1 bg-emerald-600 text-white hover:bg-emerald-500", "animate-spin": "Send Message", "installed": "supabase/supabase-js` - Database client\n- `zustand` - State management\n- `react-hot-toast` - Toast notifications\n- `lucide-react` - Icons\n\n## Success Criteria\n\n1. \u2705 Users can start conversations from equipment detail pages\n2. \u2705 Users can send messages to labourers from the labour page\n3. \u2705 Messages appear in real-time for all participants\n4. \u2705 Proper error handling and loading states\n5. \u2705 Non-authenticated users are redirected to login\n6. \u2705 Read receipts and unread counts work correctly\n\n## Next Steps\n\nOnce this plan is approved"}]
